{"version":3,"sources":["../../../../../assets/script/gameCore/assets/script/gameCore/PreviewGrid.js"],"names":["GameGrid","require","Util","scaleParam","cc","Class","extends","Component","properties","gameGrid","default","type","Kcount","liubianxingH","liubianxingA","kuaiTex","SpriteFrame","color1","color2","color3","color4","anSound","url","AudioClip","fangxiaSound1","fangxiaSound2","fangxiaSound3","canNotSound1","canNotSound2","initBlockConfig","a","h","_configLists","p","onLoad","blockItemList","gridItemList","node","cascadeOpacity","addTouchEvent","start","createNextNode","removeAllChildren","oneNode","newOneNode","addChild","createOneBlock","colorIndex","Node","sprite","addComponent","Sprite","spriteFrame","wenliNode","wenliSprite","parent","kuaiNode","config","randomIndex","random","length","posList","sumX","countX","sumY","countY","index","pos","kuai","x","y","setScale","upH","self","ox","oy","on","EventType","TOUCH_START","getChildByName","audioEngine","playEffect","TOUCH_MOVE","event","delta","touch","getDelta","collisionFunc","checkIsCanDrop","changeColorDeal","TOUCH_CANCEL","dropDownFunc","TOUCH_END","isJustClearColor","i","frameList","guangPicNode","active","children","pianyiCPos","pAdd","childPos","position","frame","checkPosFunc","push","len","frameNode","dis","pDistance","checkIsLose","canDropCount","srcPos","count","isHaveBlock","j","k","tFrameNode","putItemBack","curBlockNum","emit","ranC","landingEffect","picNode","spr","action","repeatForever","sequence","spawn","fadeOut","scaleTo","removeSelf","runAction"],"mappings":"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","file":"PreviewGrid.js","sourceRoot":"../../../../../assets/script/gameCore","sourcesContent":["\r\n\r\n\r\nconst GameGrid = require('GameGrid');\r\nconst Util = require('Util');\r\nconst scaleParam = 0.7;\r\n\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        gameGrid: {\r\n            default: null,\r\n            type: GameGrid\r\n        },\r\n\r\n        Kcount: 3,\r\n        liubianxingH: 0,\r\n        liubianxingA: 0,\r\n\r\n        kuaiTex: {\r\n            default: null,\r\n            type: cc.SpriteFrame,\r\n        },\r\n\r\n        color1: {\r\n            default: null,\r\n            type: cc.SpriteFrame,\r\n        },\r\n\r\n        color2: {\r\n            default: null,\r\n            type: cc.SpriteFrame,\r\n        },\r\n\r\n        color3: {\r\n            default: null,\r\n            type: cc.SpriteFrame,\r\n        },\r\n\r\n        color4: {\r\n            default: null,\r\n            type: cc.SpriteFrame,\r\n        },\r\n\r\n        anSound: {\r\n            default: null,\r\n            url: cc.AudioClip,\r\n        },\r\n\r\n        fangxiaSound1: {\r\n            default: null,\r\n            url: cc.AudioClip,\r\n        },\r\n\r\n        fangxiaSound2: {\r\n            default: null,\r\n            url: cc.AudioClip,\r\n        },\r\n\r\n        fangxiaSound3: {\r\n            default: null,\r\n            url: cc.AudioClip,\r\n        },\r\n\r\n        canNotSound1: {\r\n            default: null,\r\n            url: cc.AudioClip,\r\n        },\r\n\r\n        canNotSound2: {\r\n            default: null,\r\n            url: cc.AudioClip,\r\n        },\r\n\r\n    },\r\n\r\n    initBlockConfig () {\r\n        let a = this[\"liubianxingA\"];\r\n        let h = this[\"liubianxingH\"];\r\n\r\n        this._configLists = [\r\n            //单个\r\n            [cc.p(0, 0)],\r\n\r\n            //两个\r\n            [cc.p(0, 0), cc.p(h * 2, 0)],    // 横摆\r\n            [cc.p(0, 0), cc.p(h, a * 1.5)],  // 正斜\r\n            [cc.p(0, 0), cc.p(h, -a * 1.5)], // 反斜\r\n        ];\r\n    },\r\n\r\n    // use this for initialization\r\n    onLoad () {\r\n        //\r\n        this.blockItemList = [];  // 当前网格中已经放置的方块元素\r\n        this.gridItemList  = []; // 全部网格元素精灵 (方块元素放到对应的网格元素上)\r\n\r\n        this.initBlockConfig();\r\n\r\n        this.node.cascadeOpacity = true;\r\n\r\n        // 添加触摸\r\n        this.addTouchEvent();\r\n    },\r\n\r\n    start () {\r\n        this.createNextNode();\r\n    },\r\n\r\n    //update (dt) { },\r\n\r\n    createNextNode () {\r\n        this.node.removeAllChildren();\r\n\r\n        let oneNode = this.newOneNode();\r\n        this.node.addChild(oneNode);\r\n    },\r\n\r\n    /**\r\n     * 创建一个新块\r\n     * @param colorIndex\r\n     * @returns {cc.Node}\r\n     */\r\n    createOneBlock (colorIndex) {\r\n        // 创建一个块\r\n        let node = new cc.Node(\"colorSpr\");\r\n        let sprite = node.addComponent(cc.Sprite);\r\n        sprite.spriteFrame = this[\"color\" + colorIndex];\r\n\r\n        // 加纹理\r\n        let wenliNode = new cc.Node(\"wenliSpr\");\r\n        let wenliSprite = wenliNode.addComponent(cc.Sprite);\r\n        wenliSprite.spriteFrame = this[\"kuaiTex\"];\r\n        wenliNode.parent = node;\r\n\r\n        return node;\r\n    },\r\n\r\n    /**\r\n     * 创建新块节点\r\n     * @returns {cc.Node}\r\n     */\r\n    newOneNode () {\r\n        let kuaiNode = new cc.Node(\"kuai\");\r\n        let config = this._configLists;\r\n\r\n        //随机样子\r\n        let randomIndex = Util.random(0, config.length - 1);\r\n        let posList = config[randomIndex];\r\n\r\n        randomIndex = Util.random(1, 4);\r\n        let sumX = 0;\r\n        let countX = 0;\r\n        let sumY = 0;\r\n        let countY = 0;\r\n\r\n        for (let index = 0; index < posList.length; index++) {\r\n            let pos = posList[index];\r\n            let kuai = this.createOneBlock(randomIndex);\r\n            kuai.x = pos.x;\r\n\r\n            sumX += kuai.x;\r\n            countX++;\r\n\r\n            kuai.y = pos.y;\r\n\r\n            sumY += kuai.y;\r\n            countY++;\r\n\r\n            kuaiNode.addChild(kuai);\r\n        }\r\n\r\n        kuaiNode.x = -sumX / countX;\r\n        kuaiNode.y = -sumY / countY;\r\n\r\n        kuaiNode.setScale(scaleParam);\r\n\r\n        return kuaiNode;\r\n    },\r\n\r\n    /**\r\n     * 添加触摸事件\r\n     */\r\n    addTouchEvent () {\r\n        let upH = 100;\r\n        let self = this;\r\n\r\n        this.node.ox = this.node.x;\r\n        this.node.oy = this.node.y;\r\n\r\n        this.node.on(cc.Node.EventType.TOUCH_START, function() {\r\n            this.y += upH;\r\n            this.getChildByName(\"kuai\").setScale(1);\r\n            cc.audioEngine.playEffect(self.anSound);\r\n\r\n        }, this.node);\r\n\r\n        this.node.on(cc.Node.EventType.TOUCH_MOVE, function(event) {\r\n            let delta = event.touch.getDelta();\r\n            this.x += delta.x;\r\n            this.y += delta.y;\r\n\r\n            self.collisionFunc();\r\n\r\n            // 变色处理\r\n            if (!self.checkIsCanDrop()) {\r\n                self.changeColorDeal(true);\r\n            } else {\r\n                self.changeColorDeal();\r\n            }\r\n        }, this.node);\r\n\r\n        this.node.on(cc.Node.EventType.TOUCH_CANCEL, function(event) {\r\n            this.dropDownFunc();\r\n\r\n        }, this);\r\n\r\n        this.node.on(cc.Node.EventType.TOUCH_END, function(event) {\r\n            this.dropDownFunc();\r\n\r\n        }, this)\r\n\r\n    },\r\n\r\n    // 变色处理\r\n    changeColorDeal (isJustClearColor) {\r\n        //\r\n        for (let i = 0; i < this.gameGrid.frameList.length; i++) {\r\n            let guangPicNode = this.gameGrid.frameList[i].getChildByName(\"bianSpr\");\r\n            guangPicNode.active = false;\r\n        }\r\n\r\n        // 如果参数有值，直接返回，不做下面的\r\n        if (isJustClearColor) {\r\n            return;\r\n        }\r\n\r\n        for (let i = 0; i < this.gridItemList.length; i++) {\r\n            let guangPicNode = this.gridItemList[i].getChildByName(\"bianSpr\");\r\n            guangPicNode.active = true;\r\n        }\r\n    },\r\n\r\n\r\n    //碰撞逻辑\r\n    collisionFunc () {\r\n        //\r\n        this.gridItemList = []; //清空数组\r\n        this.blockItemList = [];    //清空数组\r\n\r\n        let children = this.node.children[0].children;\r\n\r\n        for (let i = 0; i < children.length; i++) {\r\n\r\n            let pianyiCPos = cc.pAdd(cc.p(this.node.children[0].x, this.node.children[0].y), cc.p(children[i].x, children[i].y))\r\n            let childPos = cc.pAdd(this.node.position, pianyiCPos);\r\n            let frame = this.checkPosFunc(childPos);\r\n\r\n            if (frame) {\r\n                this.blockItemList.push(children[i]);\r\n                this.gridItemList.push(frame)\r\n            }\r\n        }\r\n    },\r\n\r\n\r\n    // 一个点和棋盘的所有框检测\r\n    checkPosFunc (pos) {\r\n        let len = 27; // 碰撞距离\r\n\r\n        for (let i = 0; i < this.gameGrid.frameList.length; i++) {\r\n            let frameNode = this.gameGrid.frameList[i];\r\n            let dis = cc.pDistance(cc.p(frameNode.x, frameNode.y), pos);\r\n\r\n            if (dis <= len) {\r\n                return frameNode\r\n            }\r\n        }\r\n    },\r\n\r\n    //检测自身是否已经无处可放\r\n    checkIsLose () {\r\n        let canDropCount = 0;\r\n        let children = this.node.children[0].children;\r\n\r\n        // 一个个格子放试一下能不能放\r\n        for (let i = 0; i < this.gameGrid.frameList.length; i++) {\r\n            let frameNode = this.gameGrid.frameList[i];\r\n            let srcPos = cc.p(frameNode.x, frameNode.y);\r\n            let count = 1;\r\n\r\n            if ( !frameNode.isHaveBlock ) {\r\n                // 这里做是否可以放的判断\r\n                for (let j = 1; j < children.length; j++) {\r\n                    let len = 27; // 碰撞距离\r\n                    let childPos = cc.pAdd(srcPos, cc.p(children[j].x, children[j].y));\r\n\r\n                    // 碰撞检测\r\n                    for (let k = 0; k < this.gameGrid.frameList.length; k++) {\r\n                        let tFrameNode = this.gameGrid.frameList[k];\r\n                        let dis = cc.pDistance(cc.p(tFrameNode.x, tFrameNode.y), childPos);\r\n\r\n                        if (dis <= len && !tFrameNode.isHaveBlock) {\r\n                            count++; // 可以放就要累加计数\r\n                        }\r\n                    }\r\n                }\r\n\r\n                // 如果数量相等就说明这个方块在这个格子是可以放下的\r\n                if (count === children.length) {\r\n                    //cc.log(frameNode.FKIndex + \"的位置可以放\", children.length, count)\r\n                    canDropCount++;\r\n                }\r\n            }\r\n        }\r\n\r\n        return (canDropCount === 0);\r\n    },\r\n\r\n    //检测是否能够放下\r\n    checkIsCanDrop () {\r\n        // 先判断数量是否一致，不一致说明有一个超出去了\r\n        if (this.gridItemList.length === 0 || this.gridItemList.length !== this.node.children[0].children.length) {\r\n            return false;\r\n        }\r\n\r\n        // 检测放下的格子是否已经有方块\r\n        for (let i = 0; i < this.gridItemList.length; i++) {\r\n            if (this.gridItemList[i].isHaveBlock) {\r\n                return false;\r\n            }\r\n        }\r\n        return true;\r\n    },\r\n\r\n    //放下逻辑\r\n    dropDownFunc () {\r\n        //\r\n        if (!this.checkIsCanDrop()) {\r\n            // 放回去\r\n            this.putItemBack();\r\n            cc.audioEngine.playEffect(this.canNotSound1);\r\n            return;\r\n        }\r\n\r\n        for (let i = 0; i < this.blockItemList.length; i++) {\r\n            this.blockItemList[i].x = 0;\r\n            this.blockItemList[i].y = 0;\r\n\r\n            this.blockItemList[i].parent = this.gridItemList[i];  // 方块添加到对应到网格上\r\n            this.gridItemList[i].isHaveBlock = true;\r\n\r\n            // 落地特效\r\n            //this.landingEffect();\r\n        }\r\n\r\n        // 生成下一个\r\n        this.createNextNode();\r\n\r\n        this.gameGrid.curBlockNum = this.blockItemList.length;\r\n        this.gameGrid.node.emit('succDropDownOne');\r\n\r\n        let ranC = Util.random(1, 3);\r\n        cc.audioEngine.playEffect(this[\"fangxiaSound\" + ranC]);\r\n\r\n        // 放回去\r\n        this.putItemBack();\r\n\r\n        //直接用棋盘检测是不是输了\r\n        this.gameGrid.checkIsLose();\r\n    },\r\n\r\n    /**\r\n     * 落地特效\r\n     */\r\n    landingEffect () {\r\n        let picNode = new cc.Node(\"guangEffNode\");\r\n        let spr = picNode.addComponent(cc.Sprite);\r\n\r\n        spr.spriteFrame = this.gameGrid[\"bian\"];\r\n        this.gridItemList[i].addChild(picNode, -1);\r\n\r\n        let action = cc.repeatForever(cc.sequence(\r\n            cc.spawn(cc.fadeOut(1), cc.scaleTo(1, 1.2)),\r\n            cc.removeSelf()\r\n        ));\r\n\r\n        picNode.runAction(action);\r\n    },\r\n\r\n    /**\r\n     * 回到原位\r\n     */\r\n    putItemBack () {\r\n        //变色处理\r\n        this.gridItemList = []; //清空数组\r\n        this.changeColorDeal();\r\n\r\n        this.node.getChildByName(\"kuai\").setScale(scaleParam);\r\n\r\n        this.node.x = this.node.ox;\r\n        this.node.y = this.node.oy;\r\n    },\r\n\r\n});"]}