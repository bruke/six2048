{"version":3,"sources":["../../../../../assets/script/gameCore/assets/script/gameCore/GameGrid.js"],"names":["BasicLineNum","disList","Util","require","theScore","cc","Class","extends","Component","properties","liubianxingH","liubianxingA","framePic","default","type","SpriteFrame","bian","clearSound","url","AudioClip","losePrefab","Prefab","boomEffPrefab","tipPrefab","onLoad","isDeleting","node","on","checkEliminate","initHiScore","start","initGridOriginPos","initGridNodes","srcPos","p","x","y","posList","count","addVec","pMult","pForAngle","Math","PI","pianyiTo0p0Vec","frameList","fPosList","i","length","oneSrcPos","pAdd","aimPos","j","fPos","push","index","Node","sprite","addComponent","Sprite","spriteFrame","parent","FKIndex","picNode","spr","active","evt","addScore","curBlockNum","tipNode","instantiate","color","label","getComponent","Label","string","getAddScoreCal","addChild","haveFKIndexList","isHaveBlock","sort","a","b","eliminateList","oneList","intersectAry","get2AryIntersect","needClear","check2AryIsEqual","doEliminate","audioEngine","playEffect","actionAry","xIndex","callFunc","arguments","effNode","FKNode","getChildByName","cascadeOpacity","runAction","sequence","spawn","scaleTo","fadeOut","removeSelf","delayTime","checkIsLose","action","find","script","opacity","showLoseEffect","loseNode","saveHiScore","clearCount","isDropAdd","addScoreCount","Number","ary1","ary2","sys","localStorage","getItem","score","oldScore","setItem"],"mappings":"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","file":"GameGrid.js","sourceRoot":"../../../../../assets/script/gameCore","sourcesContent":["\r\n\r\nconst BasicLineNum = 5;  // 网格基础行格子数量\r\n\r\nconst disList = [\r\n            [0,  1,  2,  3,  4],\r\n          [5,  6,  7,  8,  9,  10],\r\n        [11, 12, 13, 14, 15, 16, 17],\r\n      [18, 19, 20, 21, 22, 23, 24, 25],\r\n    [26, 27, 28, 29, 30, 31, 32, 33, 34],\r\n      [35, 36, 37, 38, 39, 40, 41, 42],\r\n       [43, 44, 45, 46, 47, 48, 49],\r\n         [50, 51, 52, 53, 54, 55],\r\n           [56, 57, 58, 59, 60],\r\n\r\n    /*\r\n    //一个方向\r\n          [0,  1,  2,  3],\r\n        [4,  5,  6,  7,  8],\r\n      [9, 10, 11, 12, 13, 14],\r\n    [15, 16, 17, 18, 19, 20, 21],\r\n      [22, 23, 24, 25, 26, 27],\r\n        [28, 29, 30, 31, 32],\r\n          [33, 34, 35, 36],\r\n    */\r\n];\r\n\r\nconst Util = require('Util');\r\nlet theScore = 0;\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        liubianxingH: 0,\r\n        liubianxingA: 0,\r\n\r\n        framePic: {\r\n            default: null,\r\n            type: cc.SpriteFrame,\r\n        },\r\n\r\n        bian: {\r\n            default: null,\r\n            type: cc.SpriteFrame,\r\n        },\r\n\r\n        clearSound: {\r\n            default: null,\r\n            url: cc.AudioClip,\r\n        },\r\n\r\n        losePrefab: {\r\n            default: null,\r\n            type: cc.Prefab,\r\n        },\r\n\r\n        boomEffPrefab: {\r\n            default: null,\r\n            type: cc.Prefab,\r\n        },\r\n\r\n        tipPrefab: {\r\n            default: null,\r\n            type: cc.Prefab,\r\n        },\r\n    },\r\n\r\n    //\r\n    onLoad () {\r\n        this.isDeleting = false; //判断是否正在消除的依据\r\n\r\n        //监听成功放下事件\r\n        this.node.on('succDropDownOne', this.checkEliminate, this);\r\n\r\n        //初始化历史最高分\r\n        this.initHiScore();\r\n    },\r\n\r\n    start () {\r\n        this.initGridOriginPos();\r\n        this.initGridNodes();\r\n    },\r\n\r\n    initGridOriginPos () {\r\n        //位置表\r\n        let srcPos = cc.p(this.node.x, this.node.y);\r\n        let posList = [\r\n            //第一行的位置信息\r\n            {\r\n                count: BasicLineNum,\r\n                srcPos: cc.p(0, 0)\r\n            },\r\n\r\n            //第二行的位置信息\r\n            {\r\n                count: BasicLineNum + 1,\r\n                srcPos: cc.p(2 * this[\"liubianxingH\"], 0)\r\n            },\r\n\r\n            //第三行的位置信息\r\n            {\r\n                count: BasicLineNum + 2,\r\n                srcPos: cc.p(2 * this[\"liubianxingH\"] * 2, 0)\r\n            },\r\n\r\n            //第四行的位置信息\r\n            {\r\n                count: BasicLineNum + 3,\r\n                srcPos: cc.p(2 * this[\"liubianxingH\"] * 3, 0)\r\n            },\r\n\r\n            //第五行的位置信息\r\n            {\r\n                count: BasicLineNum + 4,\r\n                srcPos: cc.p(2 * this[\"liubianxingH\"] * 4, 0)\r\n            },\r\n\r\n            //第六行的位置信息\r\n            {\r\n                count: BasicLineNum + 3,\r\n                srcPos: cc.p(2 * this[\"liubianxingH\"] * 4 + this[\"liubianxingH\"], (-3 * this[\"liubianxingA\"]) / 2)\r\n            },\r\n\r\n            //第七行的位置信息\r\n            {\r\n                count: BasicLineNum + 2,\r\n                srcPos: cc.p(2 * this[\"liubianxingH\"] * 4 + this[\"liubianxingH\"] * 2, (-3 * this[\"liubianxingA\"] * 2) / 2)\r\n            },\r\n\r\n            //第八行的位置信息\r\n            {\r\n                count: BasicLineNum + 1,\r\n                srcPos: cc.p(2 * this[\"liubianxingH\"] * 4 + this[\"liubianxingH\"] * 3, (-3 * this[\"liubianxingA\"] * 3) / 2)\r\n            },\r\n\r\n            //第九行的位置信息\r\n            {\r\n                count: BasicLineNum,\r\n                srcPos: cc.p(2 * this[\"liubianxingH\"] * 4 + this[\"liubianxingH\"] * 4, (-3 * this[\"liubianxingA\"] * 4) / 2)\r\n            },\r\n        ];\r\n\r\n        this.posList = posList;\r\n    },\r\n\r\n    initGridNodes () {\r\n        //位置表\r\n        let srcPos = cc.p(this.node.x, this.node.y);\r\n        let posList = this.posList;\r\n\r\n        //要加的单位向量\r\n        let addVec = cc.pMult(cc.pForAngle(240 * (2 * Math.PI / 360)), this[\"liubianxingH\"] * 2);\r\n\r\n        //偏移至源点0，0的向量\r\n        let pianyiTo0p0Vec = cc.pMult(cc.pForAngle(120 * (2 * Math.PI / 360)), this[\"liubianxingH\"] * 2 * 4);\r\n\r\n        let frameList = [];\r\n        let fPosList  = [];\r\n\r\n        //一列列来生成\r\n        for (let i = 0; i < posList.length; i++) {\r\n            let count = posList[i].count; //数量\r\n            let oneSrcPos = cc.pAdd(posList[i].srcPos, pianyiTo0p0Vec); //起始位置\r\n            let aimPos = cc.pAdd(srcPos, oneSrcPos); //一条的起始位置\r\n\r\n            for (let j = 0; j < count; j++) {\r\n                let fPos = cc.pAdd(aimPos, cc.pMult(addVec, j));\r\n                fPosList.push(fPos);\r\n            }\r\n        }\r\n\r\n        //初始化\r\n        for (let index = 0; index < fPosList.length; index++) {\r\n            let node = new cc.Node(\"frame\");\r\n            let sprite = node.addComponent(cc.Sprite);\r\n            sprite.spriteFrame = this[\"framePic\"];\r\n\r\n            node.x = fPosList[index].x;\r\n            node.y = fPosList[index].y;\r\n\r\n            node.parent = this.node;\r\n            node.FKIndex = index;\r\n\r\n            //加边\r\n            let picNode = new cc.Node(\"bianSpr\");\r\n            let spr = picNode.addComponent(cc.Sprite);\r\n\r\n            spr.spriteFrame = this[\"bian\"];\r\n            picNode.active = false;\r\n            picNode.parent = node;\r\n\r\n            frameList.push(node);\r\n        }\r\n\r\n        this.frameList = frameList;\r\n    },\r\n\r\n    /**\r\n     * 消除检测\r\n     */\r\n    checkEliminate: function(evt) {\r\n        //放下都加分\r\n        this.addScore(this.curBlockNum, true);\r\n\r\n        //加分飘字\r\n        let tipNode = cc.instantiate(this.tipPrefab);\r\n        tipNode.color = cc.color(211, 70, 50, 255);\r\n\r\n        let label = tipNode.getComponent(cc.Label);\r\n        label.string = \"+\" + this.getAddScoreCal(this.curBlockNum, true);\r\n        this.node.addChild(tipNode);\r\n\r\n        let haveFKIndexList = [];\r\n\r\n        for (let i = 0; i < this.frameList.length; i++) {\r\n            if (this.frameList[i].isHaveBlock) {\r\n                haveFKIndexList.push(this.frameList[i].FKIndex);\r\n            }\r\n        }\r\n\r\n        haveFKIndexList.sort(function(a, b) {\r\n            return a - b;\r\n        });\r\n\r\n        let eliminateList = []; //要消除的方块列表\r\n\r\n        for (let i = 0; i < disList.length; i++) {\r\n            let oneList = disList[i];\r\n            let intersectAry = this.get2AryIntersect(haveFKIndexList, oneList);\r\n\r\n            if (intersectAry.length > 0) {\r\n                let needClear = this.check2AryIsEqual(oneList, intersectAry);\r\n                if (needClear) {\r\n                    eliminateList.push(oneList);\r\n                }\r\n            }\r\n        }\r\n\r\n        // 消除表现特效\r\n        if (eliminateList.length > 0) {\r\n            this.doEliminate(eliminateList);\r\n\r\n            cc.audioEngine.playEffect(this.clearSound);\r\n        }\r\n    },\r\n\r\n    doEliminate (eliminateList) {\r\n        let actionAry = [];\r\n\r\n        //消除\r\n        let count = 0;\r\n        for (let i = 0; i < eliminateList.length; i++) {\r\n\r\n            let oneList = eliminateList[i];\r\n            for (let j = 0; j < oneList.length; j++) {\r\n                let xIndex = oneList[j];\r\n\r\n                //\r\n                actionAry.push(cc.callFunc(function(){\r\n                    let xIndex = arguments[1][0];\r\n                    let count = arguments[1][1];\r\n                    let effNode = cc.instantiate(this.boomEffPrefab);\r\n\r\n                    this.frameList[xIndex].addChild(effNode);\r\n\r\n                    //加分飘字\r\n                    let tipNode = cc.instantiate(this.tipPrefab);\r\n                    let label = tipNode.getComponent(cc.Label);\r\n\r\n                    label.string = \"+\" + this.getAddScoreCal(count);\r\n                    this.frameList[xIndex].addChild(tipNode)\r\n                }, this, [xIndex, count]));\r\n\r\n                //\r\n                actionAry.push(cc.callFunc(function() {\r\n                    let xIndex = arguments[1];\r\n                    this.frameList[xIndex].isHaveBlock = false;\r\n\r\n                    let FKNode = this.frameList[xIndex].getChildByName(\"colorSpr\");\r\n                    if (!FKNode) {\r\n                        return; //防止没有这个方块的时候\r\n                    }\r\n\r\n                    FKNode.cascadeOpacity = true;\r\n\r\n                    //这个假方块变大并且渐隐掉\r\n                    FKNode.runAction(cc.sequence(\r\n                        cc.spawn(cc.scaleTo(0.5, 2), cc.fadeOut(0.5)),\r\n                        cc.removeSelf(true)\r\n                    ))\r\n\r\n                }, this, xIndex));\r\n\r\n                actionAry.push(cc.delayTime(0.1));\r\n                count++;\r\n            }\r\n        }\r\n\r\n        if (actionAry.length > 0) {\r\n            actionAry.push(cc.callFunc(function() {\r\n                this.isDeleting = false;\r\n                this.checkIsLose();\r\n            }, this));\r\n\r\n            this.isDeleting = true;\r\n            let action = cc.sequence(actionAry);\r\n            this.node.runAction(action);\r\n\r\n            // 加分\r\n            this.addScore(count);\r\n        }\r\n    },\r\n\r\n    /**\r\n     * 检测是不是输了\r\n     */\r\n    checkIsLose () {\r\n        //如果正在消除中，那就不判断输赢，因为消除后会再判断\r\n        if (this.isDeleting) {\r\n            return;\r\n        }\r\n\r\n        let node = cc.find('Canvas/newBlockNode');\r\n        let script = node.getComponent('PreviewGrid');\r\n\r\n        node.opacity = 255;\r\n\r\n        if ( script.checkIsLose() ) {\r\n            //cc.log(\"已经无处安放\")\r\n            node.opacity = 125;\r\n            this.showLoseEffect();\r\n        }\r\n    },\r\n\r\n    showLoseEffect () {\r\n        let loseNode = cc.instantiate(this.losePrefab);\r\n        this.node.parent.addChild(loseNode);\r\n\r\n        // 保存历史最高分\r\n        this.saveHiScore(theScore);\r\n    },\r\n\r\n    /**\r\n     * 加分\r\n     * @param clearCount 消除的总数\r\n     * @param isDropAdd  是否放下的单纯加分\r\n     */\r\n    addScore (clearCount, isDropAdd) {\r\n        let addScoreCount = this.getAddScoreCal(clearCount, isDropAdd);\r\n        let node = cc.find('Canvas/score/scoreLabel');\r\n        let label = node.getComponent(cc.Label);\r\n\r\n        label.string = addScoreCount + Number(label.string);\r\n        theScore = Number(label.string);\r\n    },\r\n\r\n    /**\r\n     * 计算加分的公式\r\n     * @param clearCount\r\n     * @param isDropAdd\r\n     * @returns {number}\r\n     */\r\n    getAddScoreCal (clearCount, isDropAdd) {\r\n        let x = clearCount + 1;\r\n        let addScoreCount = isDropAdd ? x : 2 * x * x; // 数量的平方\r\n\r\n        return addScoreCount;\r\n    },\r\n\r\n    /**\r\n     * 获得两个数组的交集\r\n     * @param ary1\r\n     * @param ary2\r\n     * @returns {Array}\r\n     */\r\n    get2AryIntersect (ary1, ary2) {\r\n        let intersectAry = [];\r\n        for (let i = 0; i < ary1.length; i++) {\r\n            for (let j = 0; j < ary2.length; j++) {\r\n                if (ary2[j] === ary1[i]) {\r\n                    intersectAry.push(ary2[j]);\r\n                }\r\n            }\r\n        }\r\n        return intersectAry;\r\n    },\r\n\r\n    /**\r\n     * 获得两个数组是否相交\r\n     * @param ary1\r\n     * @param ary2\r\n     * @returns {boolean}\r\n     */\r\n    check2AryIsEqual: function(ary1, ary2) {\r\n        for (let i = 0; i < ary1.length; i++) {\r\n            if(ary2[i] !== ary1[i]){\r\n                return false;\r\n            }\r\n        }\r\n        return true\r\n    },\r\n\r\n    // 读取历史最高分\r\n    initHiScore () {\r\n        let node = cc.find('Canvas/highScore/scoreLabel');\r\n        let label = node.getComponent(cc.Label);\r\n\r\n        label.string = cc.sys.localStorage.getItem(\"score\") || 0;\r\n    },\r\n\r\n    // 保存历史最高分\r\n    saveHiScore (score) {\r\n        let oldScore = cc.sys.localStorage.getItem(\"score\");\r\n\r\n        if (oldScore < score) {\r\n            cc.sys.localStorage.setItem(\"score\", score);\r\n        }\r\n    },\r\n\r\n});\r\n\r\n"]}